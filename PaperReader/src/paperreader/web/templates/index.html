<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PaperReader Web</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>PaperReader Web</h1>
      <p class="subtitle">ä¸Šä¼  DOI/PDFï¼Œé…ç½® API Keyï¼Œä¸€é”®è¿è¡Œâ€œä¸‹è½½â†’è§£æâ†’æ¸…æ´—â†’LLM æŠ½å–â†’å¯¼å‡ºâ€æµæ°´çº¿ã€‚</p>
      <div class="actions">
        {% if state.running %}
          <span class="status-chip">â³ æµæ°´çº¿è¿è¡Œä¸­...</span>
        {% elif state.last_finish %}
          <span class="status-chip" style="background:#ecfdf3;color:#166534;">âœ… æœ€è¿‘å®Œæˆäº {{ state.last_finish.strftime('%Y-%m-%d %H:%M') }} UTC</span>
        {% else %}
          <span class="status-chip">ğŸŸ¢ å·²å°±ç»ª</span>
        {% endif %}
        {% if state.last_error %}
          <span class="badge" style="background:#fef2f2;color:#991b1b;">é”™è¯¯ï¼š{{ state.last_error }}</span>
        {% endif %}
        {% if state.last_output %}
          <a class="badge" href="/download?path={{ state.last_output }}">æœ€è¿‘å¯¼å‡ºï¼š{{ state.last_output.name }}</a>
        {% endif %}
      </div>
    </div>

    <div class="grid" style="margin-top:1rem;">
      <div class="card">
        <h3 class="section-title">1) ä¸Šä¼  DOI è¡¨æ ¼</h3>
        <form action="/upload/doi" method="post" enctype="multipart/form-data">
          <input class="file-input" type="file" name="file" accept=".xlsx" required />
          <p class="hint">ç¤ºä¾‹è¡¨å¤´ï¼š<code>doi</code>ã€‚æ–‡ä»¶å°†ä¿å­˜åˆ° <code>{{ settings.input_doi }}</code></p>
          <div class="actions"><button class="button" type="submit">ä¸Šä¼  DOI.xlsx</button></div>
        </form>
      </div>

      <div class="card">
        <h3 class="section-title">2) ä¸Šä¼  PDF</h3>
        <form action="/upload/pdfs" method="post" enctype="multipart/form-data">
          <input class="file-input" type="file" name="files" accept=".pdf" multiple required />
          <p class="hint">æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œå­˜æ”¾åœ¨ <code>{{ settings.input_pdfs }}</code></p>
          <div class="actions"><button class="button" type="submit">ä¸Šä¼  PDF</button></div>
        </form>
      </div>
    </div>

    <div class="card" style="margin-top:1rem;">
      <h3 class="section-title">3) é…ç½® Key å¹¶å¯åŠ¨æµæ°´çº¿</h3>
      <form action="/run" method="post">
        <div class="grid">
          <div>
            <label for="openai_api_key">OpenAI / å…¼å®¹ LLM Key</label>
            <input class="input" id="openai_api_key" name="openai_api_key" type="password" placeholder="å¯é€‰ï¼Œç•™ç©ºåˆ™ä½¿ç”¨ .env" />
          </div>
          <div>
            <label for="openai_base_url">OpenAI Base URL</label>
            <input class="input" id="openai_base_url" name="openai_base_url" type="text" placeholder="å¯é€‰ï¼Œä¾‹å¦‚ https://api.openai.com/v1" />
          </div>
          <div>
            <label for="openai_model">æ¨¡å‹åç§°</label>
            <input class="input" id="openai_model" name="openai_model" type="text" placeholder="å¯é€‰ï¼Œä¾‹å¦‚ deepseek-chat æˆ– gpt-4o-mini" />
          </div>
          <div>
            <label for="elsevier_api_key">Elsevier API Key</label>
            <input class="input" id="elsevier_api_key" name="elsevier_api_key" type="password" placeholder="å¯é€‰ï¼Œç•™ç©ºåˆ™ä½¿ç”¨ .env" />
          </div>
        </div>
        <div class="actions" style="margin-top:1rem;">
          <button class="button" type="submit" {% if state.running %}disabled{% endif %}>ğŸš€ è¿è¡Œæµæ°´çº¿</button>
          <span class="hint">å°†è¯»å– DOI/PDFï¼Œè°ƒç”¨ Uni-parser & LLMï¼Œå¹¶å¯¼å‡º XLSXã€‚</span>
        </div>
      </form>
    </div>

    <div class="grid" style="margin-top:1rem;">
      <div class="card">
        <h3 class="section-title">è¾“å…¥æ–‡ä»¶</h3>
        <table class="table">
          <tr><th>ç±»å‹</th><th>ä½ç½®</th></tr>
          <tr>
            <td>DOI è¡¨æ ¼</td>
            <td>{{ settings.input_doi if settings.input_doi.exists() else 'æœªä¸Šä¼ ' }}</td>
          </tr>
          <tr>
            <td>PDF æ•°é‡</td>
            <td>{{ pdfs|length }} ä¸ª ({{ settings.input_pdfs }})</td>
          </tr>
        </table>
        <ul class="list">
          {% for pdf in pdfs %}
            <li>ğŸ“„ {{ pdf.name }}</li>
          {% endfor %}
          {% if pdfs|length == 0 %}
            <li class="muted">æš‚æ—  PDF ä¸Šä¼ </li>
          {% endif %}
        </ul>
      </div>

      <div class="card">
        <h3 class="section-title">è¾“å‡ºæ–‡ä»¶</h3>
        <ul class="list">
          <li>è§£æ JSONï¼š{{ parsed_files|length }} ä¸ª</li>
          <li>æ¸…æ´— JSONï¼š{{ cleaned_files|length }} ä¸ª</li>
          <li>ä¿¡æ¯ JSONï¼š{{ info_files|length }} ä¸ª</li>
          <li>XLSX å¯¼å‡ºï¼š{{ xlsx_files|length }} ä¸ª</li>
        </ul>
        <table class="table">
          <tr><th>ç±»åˆ«</th><th>æ–‡ä»¶</th></tr>
          {% for file in parsed_files %}
            <tr><td>åŸå§‹</td><td><a href="/download?path={{ file }}">{{ file.name }}</a></td></tr>
          {% endfor %}
          {% for file in cleaned_files %}
            <tr><td>æ¸…æ´—</td><td><a href="/download?path={{ file }}">{{ file.name }}</a></td></tr>
          {% endfor %}
          {% for file in info_files %}
            <tr><td>ä¿¡æ¯</td><td><a href="/download?path={{ file }}">{{ file.name }}</a></td></tr>
          {% endfor %}
          {% for file in xlsx_files %}
            <tr><td>XLSX</td><td><a href="/download?path={{ file }}">{{ file.name }}</a></td></tr>
          {% endfor %}
          {% if parsed_files|length + cleaned_files|length + info_files|length + xlsx_files|length == 0 %}
            <tr><td colspan="2" class="muted">æš‚æ— è¾“å‡ºæ–‡ä»¶</td></tr>
          {% endif %}
        </table>
      </div>
    </div>

    <p class="footer">PaperReader â€¢ FastAPI + Jinja2 å‰ç«¯ â€¢ ä¿®æ”¹ .env æˆ–è¡¨å•å³å¯è‡ªå®šä¹‰ API Key</p>
  </div>
</body>
</html>
